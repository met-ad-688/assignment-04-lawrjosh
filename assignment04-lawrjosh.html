<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joshua Lawrence">
<meta name="dcterms.date" content="2025-10-08">

<title>Assignment 04</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="assignment04-lawrjosh_files/libs/clipboard/clipboard.min.js"></script>
<script src="assignment04-lawrjosh_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="assignment04-lawrjosh_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="assignment04-lawrjosh_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="assignment04-lawrjosh_files/libs/quarto-html/popper.min.js"></script>
<script src="assignment04-lawrjosh_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="assignment04-lawrjosh_files/libs/quarto-html/anchor.min.js"></script>
<link href="assignment04-lawrjosh_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="assignment04-lawrjosh_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="assignment04-lawrjosh_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="assignment04-lawrjosh_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="assignment04-lawrjosh_files/libs/bootstrap/bootstrap-710a1e75bc25b7dc53c6f79836f8e6d9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#load-the-dataset" id="toc-load-the-dataset" class="nav-link active" data-scroll-target="#load-the-dataset"><span class="header-section-number">1</span> Load the Dataset</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering"><span class="header-section-number">2</span> Feature Engineering</a></li>
  <li><a href="#traintest-split" id="toc-traintest-split" class="nav-link" data-scroll-target="#traintest-split"><span class="header-section-number">3</span> Train/Test Split</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression"><span class="header-section-number">4</span> Linear Regression</a></li>
  <li><a href="#polynomial-regression" id="toc-polynomial-regression" class="nav-link" data-scroll-target="#polynomial-regression"><span class="header-section-number">5</span> Polynomial Regression</a></li>
  <li><a href="#random-forest-regressor" id="toc-random-forest-regressor" class="nav-link" data-scroll-target="#random-forest-regressor"><span class="header-section-number">6</span> Random Forest Regressor</a>
  <ul class="collapse">
  <li><a href="#feature-importance-plot" id="toc-feature-importance-plot" class="nav-link" data-scroll-target="#feature-importance-plot"><span class="header-section-number">6.1</span> Feature Importance Plot</a></li>
  </ul></li>
  <li><a href="#compare-3-models-glr-polynomial-rf" id="toc-compare-3-models-glr-polynomial-rf" class="nav-link" data-scroll-target="#compare-3-models-glr-polynomial-rf"><span class="header-section-number">7</span> Compare 3 Models – GLR, Polynomial, RF</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="assignment04-lawrjosh.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment 04</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Joshua Lawrence </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Boston University
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 8, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 8, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="load-the-dataset" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Load the Dataset</h1>
<div id="cbc1aca5" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> StringIndexer, OneHotEncoder, VectorAssembler</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression, RandomForestRegressor</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.evaluation <span class="im">import</span> RegressionEvaluator</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>pio.renderers.default <span class="op">=</span> <span class="st">"notebook+notebook_connected+vscode"</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Spark Session</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.appName(<span class="st">"LightcastData"</span>).getOrCreate()</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Data</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.read.option(<span class="st">"header"</span>, <span class="st">"true"</span>).option(<span class="st">"inferSchema"</span>, <span class="st">"true"</span>).option(<span class="st">"multiLine"</span>,<span class="st">"true"</span>).option(<span class="st">"escape"</span>, <span class="st">"</span><span class="ch">\"</span><span class="st">"</span>).csv(<span class="st">"data/lightcast_job_postings.csv"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Show Schema and Sample Data</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># df.printSchema() # comment this line when rendering the submission</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>df.show(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING: Using incubator modules: jdk.incubator.vector
Using Spark's default log4j profile: org/apache/spark/log4j2-defaults.properties
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
25/10/08 04:31:52 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[Stage 0:===========================================================(1 + 0) / 1]                                                                                [Stage 1:&gt;                                                          (0 + 1) / 1]                                                                                25/10/08 04:32:07 WARN SparkStringUtils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.sql.debug.maxToStringFields'.
[Stage 2:&gt;                                                          (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+-----------------+----------------------+----------+--------+---------+--------+--------------------+--------------------+--------------------+-----------+-------------------+--------------------+--------------------+---------------+----------------+--------+--------------------+-----------+-------------------+----------------+---------------------+-------------+-------------------+-------------+------------------+---------------+--------------------+--------------------+--------------------+-------------+------+-----------+----------------+-------------------+---------+-----------+--------------------+--------------------+-------------+------+--------------+-----+--------------------+-----+----------+---------------+--------------------+---------------+--------------------+------------+--------------------+------------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+----------+---------------+----------+---------------+---------------+--------------------+--------------+--------------------+--------------------------+-------------------------------+--------------------+-------------------------+-----------------------------+----------------------------------+-----------------+----------------------+-----------------------+----------------------------+------------------+-----------------------+-------+--------------------+-------+--------------------+-------+---------------+-------+---------------+-----------------+----------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+
|                  ID|LAST_UPDATED_DATE|LAST_UPDATED_TIMESTAMP|DUPLICATES|  POSTED|  EXPIRED|DURATION|        SOURCE_TYPES|             SOURCES|                 URL|ACTIVE_URLS|ACTIVE_SOURCES_INFO|           TITLE_RAW|                BODY|MODELED_EXPIRED|MODELED_DURATION| COMPANY|        COMPANY_NAME|COMPANY_RAW|COMPANY_IS_STAFFING|EDUCATION_LEVELS|EDUCATION_LEVELS_NAME|MIN_EDULEVELS| MIN_EDULEVELS_NAME|MAX_EDULEVELS|MAX_EDULEVELS_NAME|EMPLOYMENT_TYPE|EMPLOYMENT_TYPE_NAME|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|IS_INTERNSHIP|SALARY|REMOTE_TYPE|REMOTE_TYPE_NAME|ORIGINAL_PAY_PERIOD|SALARY_TO|SALARY_FROM|            LOCATION|                CITY|    CITY_NAME|COUNTY|   COUNTY_NAME|  MSA|            MSA_NAME|STATE|STATE_NAME|COUNTY_OUTGOING|COUNTY_NAME_OUTGOING|COUNTY_INCOMING|COUNTY_NAME_INCOMING|MSA_OUTGOING|   MSA_NAME_OUTGOING|MSA_INCOMING|   MSA_NAME_INCOMING|NAICS2|         NAICS2_NAME|NAICS3|         NAICS3_NAME|NAICS4|         NAICS4_NAME|NAICS5|         NAICS5_NAME|NAICS6|         NAICS6_NAME|             TITLE|         TITLE_NAME|         TITLE_CLEAN|              SKILLS|         SKILLS_NAME|  SPECIALIZED_SKILLS|SPECIALIZED_SKILLS_NAME|      CERTIFICATIONS| CERTIFICATIONS_NAME|       COMMON_SKILLS|  COMMON_SKILLS_NAME|     SOFTWARE_SKILLS|SOFTWARE_SKILLS_NAME|      ONET|           ONET_NAME| ONET_2019|      ONET_2019_NAME|                CIP6|           CIP6_NAME|                CIP4|           CIP4_NAME|                CIP2|           CIP2_NAME|SOC_2021_2|     SOC_2021_2_NAME|SOC_2021_3|     SOC_2021_3_NAME|SOC_2021_4|SOC_2021_4_NAME|SOC_2021_5|SOC_2021_5_NAME|LOT_CAREER_AREA|LOT_CAREER_AREA_NAME|LOT_OCCUPATION| LOT_OCCUPATION_NAME|LOT_SPECIALIZED_OCCUPATION|LOT_SPECIALIZED_OCCUPATION_NAME|LOT_OCCUPATION_GROUP|LOT_OCCUPATION_GROUP_NAME|LOT_V6_SPECIALIZED_OCCUPATION|LOT_V6_SPECIALIZED_OCCUPATION_NAME|LOT_V6_OCCUPATION|LOT_V6_OCCUPATION_NAME|LOT_V6_OCCUPATION_GROUP|LOT_V6_OCCUPATION_GROUP_NAME|LOT_V6_CAREER_AREA|LOT_V6_CAREER_AREA_NAME|  SOC_2|          SOC_2_NAME|  SOC_3|          SOC_3_NAME|  SOC_4|     SOC_4_NAME|  SOC_5|     SOC_5_NAME|LIGHTCAST_SECTORS|LIGHTCAST_SECTORS_NAME|NAICS_2022_2|   NAICS_2022_2_NAME|NAICS_2022_3|   NAICS_2022_3_NAME|NAICS_2022_4|   NAICS_2022_4_NAME|NAICS_2022_5|   NAICS_2022_5_NAME|NAICS_2022_6|   NAICS_2022_6_NAME|
+--------------------+-----------------+----------------------+----------+--------+---------+--------+--------------------+--------------------+--------------------+-----------+-------------------+--------------------+--------------------+---------------+----------------+--------+--------------------+-----------+-------------------+----------------+---------------------+-------------+-------------------+-------------+------------------+---------------+--------------------+--------------------+--------------------+-------------+------+-----------+----------------+-------------------+---------+-----------+--------------------+--------------------+-------------+------+--------------+-----+--------------------+-----+----------+---------------+--------------------+---------------+--------------------+------------+--------------------+------------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+----------+---------------+----------+---------------+---------------+--------------------+--------------+--------------------+--------------------------+-------------------------------+--------------------+-------------------------+-----------------------------+----------------------------------+-----------------+----------------------+-----------------------+----------------------------+------------------+-----------------------+-------+--------------------+-------+--------------------+-------+---------------+-------+---------------+-----------------+----------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+
|1f57d95acf4dc67ed...|         9/6/2024|  2024-09-06 20:32:...|         0|6/2/2024| 6/8/2024|       6|   [\n  "Company"\n]|[\n  "brassring.c...|[\n  "https://sjo...|         []|               NULL|Enterprise Analys...|31-May-2024\n\nEn...|       6/8/2024|               6|  894731|          Murphy USA| Murphy USA|              false|       [\n  2\n]| [\n  "Bachelor's ...|            2|  Bachelor's degree|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   2|                   2|        false|  NULL|          0|          [None]|               NULL|     NULL|       NULL|{\n  "lat": 33.20...|RWwgRG9yYWRvLCBBUg==|El Dorado, AR|  5139|     Union, AR|20980|       El Dorado, AR|    5|  Arkansas|           5139|           Union, AR|           5139|           Union, AR|       20980|       El Dorado, AR|       20980|       El Dorado, AR|    44|        Retail Trade|   441|Motor Vehicle and...|  4413|Automotive Parts,...| 44133|Automotive Parts ...|441330|Automotive Parts ...|ET29C073C03D1F86B4|Enterprise Analysts|enterprise analys...|[\n  "KS126DB6T06...|[\n  "Merchandisi...|[\n  "KS126DB6T06...|   [\n  "Merchandisi...|                  []|                  []|[\n  "KS126706DPF...|[\n  "Mathematics...|[\n  "KS440W865GC...|[\n  "SQL (Progra...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|[\n  "45.0601",\n...|[\n  "Economics, ...|[\n  "45.06",\n  ...|[\n  "Economics",...|[\n  "45",\n  "27...|[\n  "Social Scie...|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231010|Business Intellig...|                  23101011|           General ERP Analy...|                2310|     Business Intellig...|                     23101011|              General ERP Analy...|           231010|  Business Intellig...|                   2310|        Business Intellig...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|        [\n  7\n]|  [\n  "Artificial ...|          44|        Retail Trade|         441|Motor Vehicle and...|        4413|Automotive Parts,...|       44133|Automotive Parts ...|      441330|Automotive Parts ...|
|0cb072af26757b6c4...|         8/2/2024|  2024-08-02 17:08:...|         0|6/2/2024| 8/1/2024|    NULL| [\n  "Job Board"\n]| [\n  "maine.gov"\n]|[\n  "https://job...|         []|               NULL|Oracle Consultant...|Oracle Consultant...|       8/1/2024|            NULL|  133098|Smx Corporation L...|        SMX|               true|      [\n  99\n]| [\n  "No Educatio...|           99|No Education Listed|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   3|                   3|        false|  NULL|          1|          Remote|               NULL|     NULL|       NULL|{\n  "lat": 44.31...|    QXVndXN0YSwgTUU=|  Augusta, ME| 23011|  Kennebec, ME|12300|Augusta-Watervill...|   23|     Maine|          23011|        Kennebec, ME|          23011|        Kennebec, ME|       12300|Augusta-Watervill...|       12300|Augusta-Watervill...|    56|Administrative an...|   561|Administrative an...|  5613| Employment Services| 56132|Temporary Help Se...|561320|Temporary Help Se...|ET21DDA63780A7DC09| Oracle Consultants|oracle consultant...|[\n  "KS122626T55...|[\n  "Procurement...|[\n  "KS122626T55...|   [\n  "Procurement...|                  []|                  []|                  []|                  []|[\n  "BGSBF3F508F...|[\n  "Oracle Busi...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231010|Business Intellig...|                  23101012|           Oracle Consultant...|                2310|     Business Intellig...|                     23101012|              Oracle Consultant...|           231010|  Business Intellig...|                   2310|        Business Intellig...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|             NULL|                  NULL|          56|Administrative an...|         561|Administrative an...|        5613| Employment Services|       56132|Temporary Help Se...|      561320|Temporary Help Se...|
|85318b12b3331fa49...|         9/6/2024|  2024-09-06 20:32:...|         1|6/2/2024| 7/7/2024|      35| [\n  "Job Board"\n]|[\n  "dejobs.org"\n]|[\n  "https://dej...|         []|               NULL|        Data Analyst|Taking care of pe...|      6/10/2024|               8|39063746|            Sedgwick|   Sedgwick|              false|       [\n  2\n]| [\n  "Bachelor's ...|            2|  Bachelor's degree|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   5|                NULL|        false|  NULL|          0|          [None]|               NULL|     NULL|       NULL|{\n  "lat": 32.77...|    RGFsbGFzLCBUWA==|   Dallas, TX| 48113|    Dallas, TX|19100|Dallas-Fort Worth...|   48|     Texas|          48113|          Dallas, TX|          48113|          Dallas, TX|       19100|Dallas-Fort Worth...|       19100|Dallas-Fort Worth...|    52|Finance and Insur...|   524|Insurance Carrier...|  5242|Agencies, Brokera...| 52429|Other Insurance R...|524291|    Claims Adjusting|ET3037E0C947A02404|      Data Analysts|        data analyst|[\n  "KS1218W78FG...|[\n  "Management"...|[\n  "ESF3939CE1F...|   [\n  "Exception R...|[\n  "KS683TN76T7...|[\n  "Security Cl...|[\n  "KS1218W78FG...|[\n  "Management"...|[\n  "KS126HY6YLT...|[\n  "Microsoft O...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231113|Data / Data Minin...|                  23111310|                   Data Analyst|                2311|     Data Analysis and...|                     23111310|                      Data Analyst|           231113|  Data / Data Minin...|                   2311|        Data Analysis and...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|             NULL|                  NULL|          52|Finance and Insur...|         524|Insurance Carrier...|        5242|Agencies, Brokera...|       52429|Other Insurance R...|      524291|    Claims Adjusting|
|1b5c3941e54a1889e...|         9/6/2024|  2024-09-06 20:32:...|         1|6/2/2024|7/20/2024|      48| [\n  "Job Board"\n]|[\n  "disabledper...|[\n  "https://www...|         []|               NULL|Sr. Lead Data Mgm...|About this role:\...|      6/12/2024|              10|37615159|         Wells Fargo|Wells Fargo|              false|      [\n  99\n]| [\n  "No Educatio...|           99|No Education Listed|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   3|                NULL|        false|  NULL|          0|          [None]|               NULL|     NULL|       NULL|{\n  "lat": 33.44...|    UGhvZW5peCwgQVo=|  Phoenix, AZ|  4013|  Maricopa, AZ|38060|Phoenix-Mesa-Chan...|    4|   Arizona|           4013|        Maricopa, AZ|           4013|        Maricopa, AZ|       38060|Phoenix-Mesa-Chan...|       38060|Phoenix-Mesa-Chan...|    52|Finance and Insur...|   522|Credit Intermedia...|  5221|Depository Credit...| 52211|  Commercial Banking|522110|  Commercial Banking|ET2114E0404BA30075|Management Analysts|sr lead data mgmt...|[\n  "KS123QX62QY...|[\n  "Exit Strate...|[\n  "KS123QX62QY...|   [\n  "Exit Strate...|                  []|                  []|[\n  "KS7G6NP6R6L...|[\n  "Reliability...|[\n  "KS4409D76NW...|[\n  "SAS (Softwa...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231113|Data / Data Minin...|                  23111310|                   Data Analyst|                2311|     Data Analysis and...|                     23111310|                      Data Analyst|           231113|  Data / Data Minin...|                   2311|        Data Analysis and...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|        [\n  6\n]|  [\n  "Data Privac...|          52|Finance and Insur...|         522|Credit Intermedia...|        5221|Depository Credit...|       52211|  Commercial Banking|      522110|  Commercial Banking|
|cb5ca25f02bdf25c1...|        6/19/2024|   2024-06-19 07:00:00|         0|6/2/2024|6/17/2024|      15|[\n  "FreeJobBoar...|[\n  "craigslist....|[\n  "https://mod...|         []|               NULL|Comisiones de $10...|Comisiones de $10...|      6/17/2024|              15|       0|        Unclassified|      LH/GM|              false|      [\n  99\n]| [\n  "No Educatio...|           99|No Education Listed|         NULL|              NULL|              3|Part-time / full-...|                NULL|                NULL|        false| 92500|          0|          [None]|               year|   150000|      35000|{\n  "lat": 37.63...|    TW9kZXN0bywgQ0E=|  Modesto, CA|  6099|Stanislaus, CA|33700|         Modesto, CA|    6|California|           6099|      Stanislaus, CA|           6099|      Stanislaus, CA|       33700|         Modesto, CA|       33700|         Modesto, CA|    99|Unclassified Indu...|   999|Unclassified Indu...|  9999|Unclassified Indu...| 99999|Unclassified Indu...|999999|Unclassified Indu...|ET0000000000000000|       Unclassified|comisiones de por...|                  []|                  []|                  []|                     []|                  []|                  []|                  []|                  []|                  []|                  []|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231010|Business Intellig...|                  23101012|           Oracle Consultant...|                2310|     Business Intellig...|                     23101012|              Oracle Consultant...|           231010|  Business Intellig...|                   2310|        Business Intellig...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|             NULL|                  NULL|          99|Unclassified Indu...|         999|Unclassified Indu...|        9999|Unclassified Indu...|       99999|Unclassified Indu...|      999999|Unclassified Indu...|
+--------------------+-----------------+----------------------+----------+--------+---------+--------+--------------------+--------------------+--------------------+-----------+-------------------+--------------------+--------------------+---------------+----------------+--------+--------------------+-----------+-------------------+----------------+---------------------+-------------+-------------------+-------------+------------------+---------------+--------------------+--------------------+--------------------+-------------+------+-----------+----------------+-------------------+---------+-----------+--------------------+--------------------+-------------+------+--------------+-----+--------------------+-----+----------+---------------+--------------------+---------------+--------------------+------------+--------------------+------------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+----------+---------------+----------+---------------+---------------+--------------------+--------------+--------------------+--------------------------+-------------------------------+--------------------+-------------------------+-----------------------------+----------------------------------+-----------------+----------------------+-----------------------+----------------------------+------------------+-----------------------+-------+--------------------+-------+--------------------+-------+---------------+-------+---------------+-----------------+----------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+
only showing top 5 rows</code></pre>
</div>
</div>
</section>
<section id="feature-engineering" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Feature Engineering</h1>
<div id="28e8b0bd" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define features and target variable</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>continuous_features <span class="op">=</span> [<span class="st">'MIN_YEARS_EXPERIENCE'</span>, <span class="st">'MAX_YEARS_EXPERIENCE'</span>, <span class="st">'SALARY_FROM'</span>, <span class="st">'SALARY_TO'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">'REMOTE_TYPE_NAME'</span>, <span class="st">'EMPLOYMENT_TYPE_NAME'</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>target_variable <span class="op">=</span> <span class="st">'SALARY'</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Select columns and drop missing values</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> continuous_features <span class="op">+</span> categorical_features <span class="op">+</span> [target_variable]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>df_cleaned <span class="op">=</span> df.select(<span class="op">*</span>selected_columns).na.drop()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create StringIndexers for categorical variables</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>indexers <span class="op">=</span> [</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    StringIndexer(inputCol<span class="op">=</span>col_name, outputCol<span class="op">=</span>col_name <span class="op">+</span> <span class="st">"_index"</span>, handleInvalid<span class="op">=</span><span class="st">"keep"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col_name <span class="kw">in</span> categorical_features</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create OneHotEncoders for indexed categorical variables</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>encoders <span class="op">=</span> [</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    OneHotEncoder(inputCol<span class="op">=</span>col_name <span class="op">+</span> <span class="st">"_index"</span>, outputCol<span class="op">=</span>col_name <span class="op">+</span> <span class="st">"_encoded"</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col_name <span class="kw">in</span> categorical_features</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare feature column names</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>encoded_categorical_cols <span class="op">=</span> [col_name <span class="op">+</span> <span class="st">"_encoded"</span> <span class="cf">for</span> col_name <span class="kw">in</span> categorical_features]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>feature_cols <span class="op">=</span> continuous_features <span class="op">+</span> encoded_categorical_cols</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create VectorAssembler for linear features</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>assembler <span class="op">=</span> VectorAssembler(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    inputCols<span class="op">=</span>feature_cols,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    outputCol<span class="op">=</span><span class="st">"features"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    handleInvalid<span class="op">=</span><span class="st">"skip"</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Build pipeline</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>pipeline_stages <span class="op">=</span> indexers <span class="op">+</span> encoders <span class="op">+</span> [assembler]</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>pipeline_stages)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform data</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>df_transformed <span class="op">=</span> pipeline.fit(df_cleaned).transform(df_cleaned)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Create polynomial feature: MIN_YEARS_EXPERIENCE_SQ</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>df_poly <span class="op">=</span> df_transformed.withColumn(</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MIN_YEARS_EXPERIENCE_SQ"</span>, </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">"MIN_YEARS_EXPERIENCE"</span>) <span class="op">*</span> col(<span class="st">"MIN_YEARS_EXPERIENCE"</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create VectorAssembler for polynomial features</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>poly_feature_cols <span class="op">=</span> continuous_features <span class="op">+</span> [<span class="st">"MIN_YEARS_EXPERIENCE_SQ"</span>] <span class="op">+</span> encoded_categorical_cols</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>assembler_poly <span class="op">=</span> VectorAssembler(</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    inputCols<span class="op">=</span>poly_feature_cols,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    outputCol<span class="op">=</span><span class="st">"features_poly"</span>,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    handleInvalid<span class="op">=</span><span class="st">"skip"</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform data with polynomial features</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> assembler_poly.transform(df_poly)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 3:&gt;                                                          (0 + 1) / 1]                                                                                [Stage 9:&gt;                                                          (0 + 1) / 1]                                                                                </code></pre>
</div>
</div>
</section>
<section id="traintest-split" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Train/Test Split</h1>
<div id="c8f5dd58" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into training and testing sets (80/20 split)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>train_final, test_final <span class="op">=</span> df_final.randomSplit([<span class="fl">0.8</span>, <span class="fl">0.2</span>], seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get counts</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>train_count <span class="op">=</span> train_final.count()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>test_count <span class="op">=</span> test_final.count()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>total_count <span class="op">=</span> df_final.count()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total observations: </span><span class="sc">{</span>total_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training set: </span><span class="sc">{</span>train_count<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>train_count<span class="op">/</span>total_count<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Testing set: </span><span class="sc">{</span>test_count<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>test_count<span class="op">/</span>total_count<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display sample data</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training Data Sample:"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>train_final.select(<span class="st">"SALARY"</span>, <span class="st">"MIN_YEARS_EXPERIENCE"</span>, <span class="st">"MAX_YEARS_EXPERIENCE"</span>, <span class="st">"SALARY_FROM"</span>, <span class="st">"SALARY_TO"</span>, <span class="st">"REMOTE_TYPE_NAME"</span>, <span class="st">"EMPLOYMENT_TYPE_NAME"</span>).show(<span class="dv">5</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Test Data Sample:"</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>test_final.select(<span class="st">"SALARY"</span>, <span class="st">"MIN_YEARS_EXPERIENCE"</span>, <span class="st">"MAX_YEARS_EXPERIENCE"</span>, <span class="st">"SALARY_FROM"</span>, <span class="st">"SALARY_TO"</span>, <span class="st">"REMOTE_TYPE_NAME"</span>, <span class="st">"EMPLOYMENT_TYPE_NAME"</span>).show(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 15:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 18:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 21:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Total observations: 3756
Training set: 3060 (81.5%)
Testing set: 696 (18.5%)

Training Data Sample:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 24:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+--------------------+--------------------+-----------+---------+----------------+--------------------+
|SALARY|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|SALARY_FROM|SALARY_TO|REMOTE_TYPE_NAME|EMPLOYMENT_TYPE_NAME|
+------+--------------------+--------------------+-----------+---------+----------------+--------------------+
| 36624|                   0|                   0|      36624|    36624|          [None]|Full-time (&gt; 32 h...|
| 36624|                   0|                   0|      36624|    36624|          [None]|Full-time (&gt; 32 h...|
| 51653|                   0|                   0|      38028|    52800|          [None]|Full-time (&gt; 32 h...|
| 44868|                   0|                   0|      38420|    48020|          [None]|Full-time (&gt; 32 h...|
| 44868|                   0|                   0|      38420|    48020|          [None]|Full-time (&gt; 32 h...|
+------+--------------------+--------------------+-----------+---------+----------------+--------------------+
only showing top 5 rows

Test Data Sample:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 25:&gt;                                                         (0 + 1) / 1]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+--------------------+--------------------+-----------+---------+----------------+--------------------+
|SALARY|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|SALARY_FROM|SALARY_TO|REMOTE_TYPE_NAME|EMPLOYMENT_TYPE_NAME|
+------+--------------------+--------------------+-----------+---------+----------------+--------------------+
| 49547|                   0|                   0|      38002|    56014|          [None]|Full-time (&gt; 32 h...|
| 41600|                   0|                   0|      41600|    41600|          [None]|Part-time (â‰¤ 32...|
| 66500|                   0|                   0|      43000|    90000|      Not Remote|Full-time (&gt; 32 h...|
| 50960|                   0|                   0|      47840|    54080|          [None]|Full-time (&gt; 32 h...|
| 56160|                   0|                   0|      52000|    60320|          [None]|Full-time (&gt; 32 h...|
+------+--------------------+--------------------+-----------+---------+----------------+--------------------+
only showing top 5 rows</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
</section>
<section id="linear-regression" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Linear Regression</h1>
<div id="4dda9fe7" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Linear Regression model</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression(featuresCol<span class="op">=</span><span class="st">"features"</span>, labelCol<span class="op">=</span><span class="st">"SALARY"</span>, maxIter<span class="op">=</span><span class="dv">100</span>, regParam<span class="op">=</span><span class="fl">0.1</span>, elasticNetParam<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>lr_model <span class="op">=</span> lr.fit(train_final)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>train_predictions <span class="op">=</span> lr_model.transform(train_final)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="op">=</span> lr_model.transform(test_final)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize evaluators</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>evaluator_r2 <span class="op">=</span> RegressionEvaluator(labelCol<span class="op">=</span><span class="st">"SALARY"</span>, predictionCol<span class="op">=</span><span class="st">"prediction"</span>, metricName<span class="op">=</span><span class="st">"r2"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>evaluator_rmse <span class="op">=</span> RegressionEvaluator(labelCol<span class="op">=</span><span class="st">"SALARY"</span>, predictionCol<span class="op">=</span><span class="st">"prediction"</span>, metricName<span class="op">=</span><span class="st">"rmse"</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>evaluator_mae <span class="op">=</span> RegressionEvaluator(labelCol<span class="op">=</span><span class="st">"SALARY"</span>, predictionCol<span class="op">=</span><span class="st">"prediction"</span>, metricName<span class="op">=</span><span class="st">"mae"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on training set</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>train_r2 <span class="op">=</span> evaluator_r2.evaluate(train_predictions)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>train_rmse <span class="op">=</span> evaluator_rmse.evaluate(train_predictions)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>train_mae <span class="op">=</span> evaluator_mae.evaluate(train_predictions)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on test set</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>test_r2 <span class="op">=</span> evaluator_r2.evaluate(test_predictions)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>test_rmse <span class="op">=</span> evaluator_rmse.evaluate(test_predictions)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>test_mae <span class="op">=</span> evaluator_mae.evaluate(test_predictions)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract model parameters</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>coefficients <span class="op">=</span> lr_model.coefficients</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>intercept <span class="op">=</span> lr_model.intercept</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> lr_model.summary</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare feature names</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> continuous_features <span class="op">+</span> encoded_categorical_cols</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficient statistics</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    coef_std_errors <span class="op">=</span> summary.coefficientStandardErrors</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    t_values <span class="op">=</span> summary.tValues</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    p_values <span class="op">=</span> summary.pValues</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    coef_data <span class="op">=</span> []</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, feature_name <span class="kw">in</span> <span class="bu">enumerate</span>(feature_names):</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(coefficients):</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>            coef <span class="op">=</span> coefficients[i]</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>            std_err <span class="op">=</span> coef_std_errors[i]</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>            t_val <span class="op">=</span> t_values[i]</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>            p_val <span class="op">=</span> p_values[i]</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>            ci_lower <span class="op">=</span> coef <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>            ci_upper <span class="op">=</span> coef <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>            coef_data.append({</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Feature'</span>: feature_name,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Coefficient'</span>: coef,</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Std_Error'</span>: std_err,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>                <span class="st">'T_Value'</span>: t_val,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">'P_Value'</span>: p_val,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Lower'</span>: ci_lower,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Upper'</span>: ci_upper</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    coef_df <span class="op">=</span> pd.DataFrame(coef_data)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    intercept_std_err <span class="op">=</span> coef_std_errors[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    intercept_t_val <span class="op">=</span> t_values[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    intercept_p_val <span class="op">=</span> p_values[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    intercept_ci_lower <span class="op">=</span> intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> intercept_std_err</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    intercept_ci_upper <span class="op">=</span> intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> intercept_std_err</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>    coef_data <span class="op">=</span> []</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, feature_name <span class="kw">in</span> <span class="bu">enumerate</span>(feature_names):</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(coefficients):</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>            coef <span class="op">=</span> coefficients[i]</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>            coef_data.append({</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Feature'</span>: feature_name,</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Coefficient'</span>: coef,</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Std_Error'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>                <span class="st">'T_Value'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>                <span class="st">'P_Value'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Lower'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Upper'</span>: <span class="st">'N/A'</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    coef_df <span class="op">=</span> pd.DataFrame(coef_data)</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    intercept_std_err <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>    intercept_t_val <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>    intercept_p_val <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    intercept_ci_lower <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    intercept_ci_upper <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"LINEAR REGRESSION MODEL SUMMARY"</span>)</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Model Performance Metrics ---"</span>)</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Intercept: </span><span class="sc">{</span>intercept<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Training Set Performance:"</span>)</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R² Score: </span><span class="sc">{</span>train_r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  RMSE: $</span><span class="sc">{</span>train_rmse<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  MAE: $</span><span class="sc">{</span>train_mae<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Test Set Performance:"</span>)</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R² Score: </span><span class="sc">{</span>test_r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  RMSE: $</span><span class="sc">{</span>test_rmse<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  MAE: $</span><span class="sc">{</span>test_mae<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Feature Coefficients and Statistical Significance ---"</span>)</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coef_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Intercept Statistics ---"</span>)</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Intercept: </span><span class="sc">{</span>intercept<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Std Error: </span><span class="sc">{</span>intercept_std_err<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"T-Value: </span><span class="sc">{</span>intercept_t_val<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"P-Value: </span><span class="sc">{</span>intercept_p_val<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"95% CI: [</span><span class="sc">{</span>intercept_ci_lower<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>intercept_ci_upper<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INTERPRETATION OF RESULTS"</span>)</span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. MODEL PERFORMANCE INTERPRETATION:"</span>)</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - R² Score (</span><span class="sc">{</span>test_r2<span class="sc">:.4f}</span><span class="ss">): Indicates that </span><span class="sc">{</span>test_r2<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">% of the variance in SALARY"</span>)</span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     is explained by the model features. A higher R² suggests better model fit."</span>)</span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - RMSE ($</span><span class="sc">{</span>test_rmse<span class="sc">:,.2f}</span><span class="ss">): On average, predictions deviate by $</span><span class="sc">{</span>test_rmse<span class="sc">:,.2f}</span><span class="ss"> from"</span>)</span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     actual salaries. Lower RMSE indicates better prediction accuracy."</span>)</span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - MAE ($</span><span class="sc">{</span>test_mae<span class="sc">:,.2f}</span><span class="ss">): The average absolute error is $</span><span class="sc">{</span>test_mae<span class="sc">:,.2f}</span><span class="ss">."</span>)</span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     This is more interpretable and less sensitive to outliers than RMSE."</span>)</span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> train_r2 <span class="op">-</span> test_r2 <span class="op">&gt;</span> <span class="fl">0.1</span>:</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - WARNING: Training R² (</span><span class="sc">{</span>train_r2<span class="sc">:.4f}</span><span class="ss">) is significantly higher than test R²"</span>)</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     (</span><span class="sc">{</span>test_r2<span class="sc">:.4f}</span><span class="ss">), suggesting potential overfitting."</span>)</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Training and test R² are similar (</span><span class="sc">{</span>train_r2<span class="sc">:.4f}</span><span class="ss"> vs </span><span class="sc">{</span>test_r2<span class="sc">:.4f}</span><span class="ss">),"</span>)</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     indicating good model generalization."</span>)</span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. COEFFICIENT INTERPRETATION:"</span>)</span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Each coefficient represents the change in SALARY for a one-unit increase"</span>)</span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     in that feature, holding all other features constant."</span>)</span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Continuous features (MIN_YEARS_EXPERIENCE, MAX_YEARS_EXPERIENCE, SALARY_FROM, SALARY_TO):"</span>)</span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Positive coefficients: Higher values increase predicted salary"</span>)</span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Negative coefficients: Higher values decrease predicted salary"</span>)</span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Encoded categorical features (REMOTE_TYPE_NAME, EMPLOYMENT_TYPE_NAME):"</span>)</span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Each encoded category represents a binary indicator (0 or 1)"</span>)</span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Positive coefficients: That category increases salary vs. baseline"</span>)</span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Negative coefficients: That category decreases salary vs. baseline"</span>)</span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. STATISTICAL SIGNIFICANCE:"</span>)</span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> coef_df[<span class="st">'P_Value'</span>].iloc[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">'N/A'</span>:</span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - P-Value &lt; 0.05: Feature is statistically significant (reject null hypothesis)"</span>)</span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - P-Value &gt; 0.05: Feature may not be statistically significant"</span>)</span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - T-Value: Larger absolute values indicate stronger evidence against null hypothesis"</span>)</span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - 95% Confidence Interval: If it doesn't contain 0, the feature is significant"</span>)</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>    significant_features <span class="op">=</span> coef_df[pd.to_numeric(coef_df[<span class="st">'P_Value'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>) <span class="op">&lt;</span> <span class="fl">0.05</span>]</span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Statistically significant features (p &lt; 0.05): </span><span class="sc">{</span><span class="bu">len</span>(significant_features)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(coef_df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - Standard errors unavailable due to multicollinearity in the data"</span>)</span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - SALARY_FROM and SALARY_TO are highly correlated with SALARY (data leakage)"</span>)</span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - This creates a singular covariance matrix, preventing calculation of"</span>)</span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     standard errors, t-values, and p-values"</span>)</span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">4. KEY INSIGHTS:"</span>)</span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - MULTICOLLINEARITY ISSUE: SALARY_FROM and SALARY_TO essentially contain"</span>)</span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     the information we're trying to predict (SALARY). This is called data leakage."</span>)</span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - In a real-world scenario, these features would not be available at prediction time."</span>)</span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - This explains the high R² but also why statistical inference is problematic."</span>)</span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - RECOMMENDATION: Remove SALARY_FROM and SALARY_TO, or create derived features"</span>)</span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     like salary_range = SALARY_TO - SALARY_FROM for more realistic modeling."</span>)</span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">5. FEATURE IMPORTANCE (by absolute coefficient value):"</span>)</span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a>coef_abs <span class="op">=</span> coef_df.copy()</span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> coef_abs[<span class="st">'Coefficient'</span>].dtype <span class="kw">in</span> [<span class="st">'float64'</span>, <span class="st">'int64'</span>]:</span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a>    coef_abs[<span class="st">'Abs_Coefficient'</span>] <span class="op">=</span> <span class="bu">abs</span>(coef_abs[<span class="st">'Coefficient'</span>])</span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a>    coef_abs_sorted <span class="op">=</span> coef_abs.sort_values(<span class="st">'Abs_Coefficient'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(coef_abs_sorted[[<span class="st">'Feature'</span>, <span class="st">'Coefficient'</span>, <span class="st">'Abs_Coefficient'</span>]].head(<span class="dv">10</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Show sample predictions</span></span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a>test_predictions.select(<span class="st">"SALARY"</span>, <span class="st">"prediction"</span>, <span class="st">"features"</span>).show(<span class="dv">10</span>, truncate<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 26:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 27:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 28:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 29:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 30:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 31:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 32:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 33:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
LINEAR REGRESSION MODEL SUMMARY
================================================================================

--- Model Performance Metrics ---
Intercept: 601.86

Training Set Performance:
  R² Score: 0.9990
  RMSE: $1,160.31
  MAE: $361.10

Test Set Performance:
  R² Score: 0.9994
  RMSE: $842.20
  MAE: $321.35

--- Feature Coefficients and Statistical Significance ---
                     Feature  Coefficient    Std_Error    T_Value  P_Value      CI_Lower     CI_Upper
        MIN_YEARS_EXPERIENCE     0.151861  3781.000705   0.000040 0.999968  -7410.609520  7410.913243
        MAX_YEARS_EXPERIENCE     0.151863  3781.000705   0.000040 0.999968  -7410.609519  7410.913245
                 SALARY_FROM     0.491617     0.001108 443.822248 0.000000      0.489446     0.493788
                   SALARY_TO     0.502292     0.000827 607.267491 0.000000      0.500671     0.503913
    REMOTE_TYPE_NAME_encoded   -10.655633 19904.167780  -0.000535 0.999573 -39022.824482 39001.513215
EMPLOYMENT_TYPE_NAME_encoded    -9.569524 19904.173479  -0.000481 0.999616 -39021.749543 39002.610495

--- Intercept Statistics ---
Intercept: 601.86
Std Error: 48598.32092014025
T-Value: 0.012384283925456664
P-Value: 0.9901198341253574
95% CI: [-94650.85359889941, 95854.56440805036]

================================================================================
INTERPRETATION OF RESULTS
================================================================================

1. MODEL PERFORMANCE INTERPRETATION:
   - R² Score (0.9994): Indicates that 99.94% of the variance in SALARY
     is explained by the model features. A higher R² suggests better model fit.
   - RMSE ($842.20): On average, predictions deviate by $842.20 from
     actual salaries. Lower RMSE indicates better prediction accuracy.
   - MAE ($321.35): The average absolute error is $321.35.
     This is more interpretable and less sensitive to outliers than RMSE.
   - Training and test R² are similar (0.9990 vs 0.9994),
     indicating good model generalization.

2. COEFFICIENT INTERPRETATION:
   - Each coefficient represents the change in SALARY for a one-unit increase
     in that feature, holding all other features constant.
   - Continuous features (MIN_YEARS_EXPERIENCE, MAX_YEARS_EXPERIENCE, SALARY_FROM, SALARY_TO):
     * Positive coefficients: Higher values increase predicted salary
     * Negative coefficients: Higher values decrease predicted salary
   - Encoded categorical features (REMOTE_TYPE_NAME, EMPLOYMENT_TYPE_NAME):
     * Each encoded category represents a binary indicator (0 or 1)
     * Positive coefficients: That category increases salary vs. baseline
     * Negative coefficients: That category decreases salary vs. baseline

3. STATISTICAL SIGNIFICANCE:
   - P-Value &lt; 0.05: Feature is statistically significant (reject null hypothesis)
   - P-Value &gt; 0.05: Feature may not be statistically significant
   - T-Value: Larger absolute values indicate stronger evidence against null hypothesis
   - 95% Confidence Interval: If it doesn't contain 0, the feature is significant

   Statistically significant features (p &lt; 0.05): 2/6

4. KEY INSIGHTS:
   - MULTICOLLINEARITY ISSUE: SALARY_FROM and SALARY_TO essentially contain
     the information we're trying to predict (SALARY). This is called data leakage.
   - In a real-world scenario, these features would not be available at prediction time.
   - This explains the high R² but also why statistical inference is problematic.
   - RECOMMENDATION: Remove SALARY_FROM and SALARY_TO, or create derived features
     like salary_range = SALARY_TO - SALARY_FROM for more realistic modeling.

5. FEATURE IMPORTANCE (by absolute coefficient value):
                     Feature  Coefficient  Abs_Coefficient
    REMOTE_TYPE_NAME_encoded   -10.655633        10.655633
EMPLOYMENT_TYPE_NAME_encoded    -9.569524         9.569524
                   SALARY_TO     0.502292         0.502292
                 SALARY_FROM     0.491617         0.491617
        MAX_YEARS_EXPERIENCE     0.151863         0.151863
        MIN_YEARS_EXPERIENCE     0.151861         0.151861

================================================================================</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 34:&gt;                                                         (0 + 1) / 1]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+------------------+----------------------------------------+
|SALARY|prediction        |features                                |
+------+------------------+----------------------------------------+
|49547 |47469.33260151953 |(11,[2,3,4,8],[38002.0,56014.0,1.0,1.0])|
|41600 |41943.24282635348 |(11,[2,3,4,9],[41600.0,41600.0,1.0,1.0])|
|66500 |67366.65629912431 |(11,[2,3,7,8],[43000.0,90000.0,1.0,1.0])|
|50960 |51334.425875735265|(11,[2,3,4,8],[47840.0,54080.0,1.0,1.0])|
|56160 |56513.853479908306|(11,[2,3,4,8],[52000.0,60320.0,1.0,1.0])|
|62400 |62783.54316293042 |(11,[2,3,5,8],[52000.0,72800.0,1.0,1.0])|
|62400 |62783.54316293042 |(11,[2,3,5,8],[52000.0,72800.0,1.0,1.0])|
|75550 |75971.38507782828 |(11,[2,3,4,8],[54000.0,97100.0,1.0,1.0])|
|75556 |75977.22042820456 |(11,[2,3,4,8],[54018.0,97094.0,1.0,1.0])|
|75556 |75977.22042820456 |(11,[2,3,4,8],[54018.0,97094.0,1.0,1.0])|
+------+------------------+----------------------------------------+
only showing top 10 rows</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
</section>
<section id="polynomial-regression" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Polynomial Regression</h1>
<div id="3086199e" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Polynomial Regression model</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>lr_poly <span class="op">=</span> LinearRegression(featuresCol<span class="op">=</span><span class="st">"features_poly"</span>, labelCol<span class="op">=</span><span class="st">"SALARY"</span>, maxIter<span class="op">=</span><span class="dv">100</span>, regParam<span class="op">=</span><span class="fl">0.1</span>, elasticNetParam<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>lr_poly_model <span class="op">=</span> lr_poly.fit(train_final)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>train_predictions_poly <span class="op">=</span> lr_poly_model.transform(train_final)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>test_predictions_poly <span class="op">=</span> lr_poly_model.transform(test_final)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on training set</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>train_r2_poly <span class="op">=</span> evaluator_r2.evaluate(train_predictions_poly)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>train_rmse_poly <span class="op">=</span> evaluator_rmse.evaluate(train_predictions_poly)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>train_mae_poly <span class="op">=</span> evaluator_mae.evaluate(train_predictions_poly)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on test set</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>test_r2_poly <span class="op">=</span> evaluator_r2.evaluate(test_predictions_poly)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>test_rmse_poly <span class="op">=</span> evaluator_rmse.evaluate(test_predictions_poly)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>test_mae_poly <span class="op">=</span> evaluator_mae.evaluate(test_predictions_poly)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract model parameters</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>coefficients_poly <span class="op">=</span> lr_poly_model.coefficients</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>intercept_poly <span class="op">=</span> lr_poly_model.intercept</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>summary_poly <span class="op">=</span> lr_poly_model.summary</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare polynomial feature names</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>poly_feature_names <span class="op">=</span> continuous_features <span class="op">+</span> [<span class="st">"MIN_YEARS_EXPERIENCE_SQ"</span>] <span class="op">+</span> encoded_categorical_cols</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficient statistics</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    coef_std_errors_poly <span class="op">=</span> summary_poly.coefficientStandardErrors</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    t_values_poly <span class="op">=</span> summary_poly.tValues</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    p_values_poly <span class="op">=</span> summary_poly.pValues</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    coef_data_poly <span class="op">=</span> []</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, feature_name <span class="kw">in</span> <span class="bu">enumerate</span>(poly_feature_names):</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(coefficients_poly):</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>            coef <span class="op">=</span> coefficients_poly[i]</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>            std_err <span class="op">=</span> coef_std_errors_poly[i]</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>            t_val <span class="op">=</span> t_values_poly[i]</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>            p_val <span class="op">=</span> p_values_poly[i]</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>            ci_lower <span class="op">=</span> coef <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>            ci_upper <span class="op">=</span> coef <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>            coef_data_poly.append({</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Feature'</span>: feature_name,</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Coefficient'</span>: coef,</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Std_Error'</span>: std_err,</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>                <span class="st">'T_Value'</span>: t_val,</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">'P_Value'</span>: p_val,</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Lower'</span>: ci_lower,</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Upper'</span>: ci_upper</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>    coef_df_poly <span class="op">=</span> pd.DataFrame(coef_data_poly)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    intercept_std_err_poly <span class="op">=</span> coef_std_errors_poly[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    intercept_t_val_poly <span class="op">=</span> t_values_poly[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    intercept_p_val_poly <span class="op">=</span> p_values_poly[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    intercept_ci_lower_poly <span class="op">=</span> intercept_poly <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> intercept_std_err_poly</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>    intercept_ci_upper_poly <span class="op">=</span> intercept_poly <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> intercept_std_err_poly</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    coef_data_poly <span class="op">=</span> []</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, feature_name <span class="kw">in</span> <span class="bu">enumerate</span>(poly_feature_names):</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(coefficients_poly):</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>            coef <span class="op">=</span> coefficients_poly[i]</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>            coef_data_poly.append({</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Feature'</span>: feature_name,</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Coefficient'</span>: coef,</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Std_Error'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>                <span class="st">'T_Value'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>                <span class="st">'P_Value'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Lower'</span>: <span class="st">'N/A'</span>,</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>                <span class="st">'CI_Upper'</span>: <span class="st">'N/A'</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    coef_df_poly <span class="op">=</span> pd.DataFrame(coef_data_poly)</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    intercept_std_err_poly <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>    intercept_t_val_poly <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>    intercept_p_val_poly <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>    intercept_ci_lower_poly <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>    intercept_ci_upper_poly <span class="op">=</span> <span class="st">'N/A'</span></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"POLYNOMIAL REGRESSION MODEL SUMMARY"</span>)</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Model Performance Metrics ---"</span>)</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Intercept: </span><span class="sc">{</span>intercept_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Training Set Performance:"</span>)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R² Score: </span><span class="sc">{</span>train_r2_poly<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  RMSE: $</span><span class="sc">{</span>train_rmse_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  MAE: $</span><span class="sc">{</span>train_mae_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Test Set Performance:"</span>)</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R² Score: </span><span class="sc">{</span>test_r2_poly<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  RMSE: $</span><span class="sc">{</span>test_rmse_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  MAE: $</span><span class="sc">{</span>test_mae_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Feature Coefficients and Statistical Significance ---"</span>)</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coef_df_poly.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Intercept Statistics ---"</span>)</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Intercept: </span><span class="sc">{</span>intercept_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Std Error: </span><span class="sc">{</span>intercept_std_err_poly<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"T-Value: </span><span class="sc">{</span>intercept_t_val_poly<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"P-Value: </span><span class="sc">{</span>intercept_p_val_poly<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"95% CI: [</span><span class="sc">{</span>intercept_ci_lower_poly<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>intercept_ci_upper_poly<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"COMPARISON: LINEAR vs POLYNOMIAL REGRESSION"</span>)</span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Linear Regression Test R²: </span><span class="sc">{</span>test_r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Polynomial Regression Test R²: </span><span class="sc">{</span>test_r2_poly<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Improvement in R²: </span><span class="sc">{</span>test_r2_poly <span class="op">-</span> test_r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Linear Regression Test RMSE: $</span><span class="sc">{</span>test_rmse<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Polynomial Regression Test RMSE: $</span><span class="sc">{</span>test_rmse_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Change in RMSE: $</span><span class="sc">{</span>test_rmse_poly <span class="op">-</span> test_rmse<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Linear Regression Test MAE: $</span><span class="sc">{</span>test_mae<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Polynomial Regression Test MAE: $</span><span class="sc">{</span>test_mae_poly<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Change in MAE: $</span><span class="sc">{</span>test_mae_poly <span class="op">-</span> test_mae<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INTERPRETATION OF POLYNOMIAL REGRESSION RESULTS"</span>)</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. MODEL PERFORMANCE INTERPRETATION:"</span>)</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - R² Score (</span><span class="sc">{</span>test_r2_poly<span class="sc">:.4f}</span><span class="ss">): The polynomial model explains </span><span class="sc">{</span>test_r2_poly<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">% of"</span>)</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     the variance in SALARY, compared to </span><span class="sc">{:.2f}% f</span><span class="st">or the linear model."</span>.<span class="bu">format</span>(test_r2<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> test_r2_poly <span class="op">&gt;</span> test_r2:</span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     * IMPROVEMENT: The polynomial model captures </span><span class="sc">{</span>(test_r2_poly <span class="op">-</span> test_r2)<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">% more variance."</span>)</span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * This suggests non-linear relationships exist in the data."</span>)</span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * The polynomial model does not improve over the linear model."</span>)</span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * This suggests the relationship may be primarily linear."</span>)</span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - RMSE ($</span><span class="sc">{</span>test_rmse_poly<span class="sc">:,.2f}</span><span class="ss">): Average prediction error for polynomial model."</span>)</span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> test_rmse_poly <span class="op">&lt;</span> test_rmse:</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     * IMPROVEMENT: $</span><span class="sc">{</span>test_rmse <span class="op">-</span> test_rmse_poly<span class="sc">:,.2f}</span><span class="ss"> reduction in RMSE."</span>)</span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * The polynomial model makes more accurate predictions."</span>)</span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     * The polynomial model has higher RMSE by $</span><span class="sc">{</span>test_rmse_poly <span class="op">-</span> test_rmse<span class="sc">:,.2f}</span><span class="ss">."</span>)</span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * This may indicate overfitting or that polynomial terms don't help."</span>)</span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - MAE ($</span><span class="sc">{</span>test_mae_poly<span class="sc">:,.2f}</span><span class="ss">): Average absolute error for polynomial model."</span>)</span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> test_mae_poly <span class="op">&lt;</span> test_mae:</span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     * IMPROVEMENT: $</span><span class="sc">{</span>test_mae <span class="op">-</span> test_mae_poly<span class="sc">:,.2f}</span><span class="ss"> reduction in MAE."</span>)</span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     * The polynomial model has higher MAE by $</span><span class="sc">{</span>test_mae_poly <span class="op">-</span> test_mae<span class="sc">:,.2f}</span><span class="ss">."</span>)</span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> train_r2_poly <span class="op">-</span> test_r2_poly <span class="op">&gt;</span> <span class="fl">0.1</span>:</span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - OVERFITTING WARNING: Training R² (</span><span class="sc">{</span>train_r2_poly<span class="sc">:.4f}</span><span class="ss">) is significantly"</span>)</span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     higher than test R² (</span><span class="sc">{</span>test_r2_poly<span class="sc">:.4f}</span><span class="ss">)."</span>)</span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * The model may have learned training data patterns that don't generalize."</span>)</span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * Consider reducing model complexity or increasing regularization."</span>)</span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - GOOD GENERALIZATION: Training R² (</span><span class="sc">{</span>train_r2_poly<span class="sc">:.4f}</span><span class="ss">) and test R²"</span>)</span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     (</span><span class="sc">{</span>test_r2_poly<span class="sc">:.4f}</span><span class="ss">) are similar, indicating the model generalizes well."</span>)</span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. POLYNOMIAL FEATURE INTERPRETATION:"</span>)</span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - MIN_YEARS_EXPERIENCE_SQ: This squared term captures non-linear relationships"</span>)</span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     between experience and salary."</span>)</span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Positive coefficient: Salary increases at an accelerating rate with experience"</span>)</span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"       (e.g., senior positions command exponentially higher salaries)"</span>)</span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Negative coefficient: Salary increases at a decelerating rate with experience"</span>)</span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"       (e.g., diminishing returns to additional years of experience)"</span>)</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * The combination of MIN_YEARS_EXPERIENCE and MIN_YEARS_EXPERIENCE_SQ allows"</span>)</span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"       the model to fit a parabolic (curved) relationship."</span>)</span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. MODEL SELECTION RECOMMENDATION:"</span>)</span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> test_r2_poly <span class="op">&gt;</span> test_r2 <span class="kw">and</span> test_rmse_poly <span class="op">&lt;</span> test_rmse:</span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - The polynomial model outperforms the linear model on both R² and RMSE."</span>)</span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - RECOMMENDATION: Use the polynomial model for predictions."</span>)</span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> test_r2_poly <span class="op">&gt;</span> test_r2 <span class="op">+</span> <span class="fl">0.01</span>:</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - The polynomial model shows modest improvement in R²."</span>)</span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - RECOMMENDATION: Consider the polynomial model if interpretability isn't critical."</span>)</span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - The polynomial model does not substantially improve performance."</span>)</span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - RECOMMENDATION: Prefer the simpler linear model (Occam's Razor)."</span>)</span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Show sample predictions</span></span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a>test_predictions_poly.select(<span class="st">"SALARY"</span>, <span class="st">"prediction"</span>, <span class="st">"features_poly"</span>).show(<span class="dv">10</span>, truncate<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 35:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 36:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 37:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 38:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 39:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 40:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 41:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 42:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
POLYNOMIAL REGRESSION MODEL SUMMARY
================================================================================

--- Model Performance Metrics ---
Intercept: 698.76

Training Set Performance:
  R² Score: 0.9990
  RMSE: $1,159.06
  MAE: $361.43

Test Set Performance:
  R² Score: 0.9994
  RMSE: $842.92
  MAE: $318.55

--- Feature Coefficients and Statistical Significance ---
                     Feature  Coefficient    Std_Error    T_Value  P_Value      CI_Lower     CI_Upper
        MIN_YEARS_EXPERIENCE   -34.705050  3777.585499  -0.009187 0.992670  -7438.772628  7369.362527
        MAX_YEARS_EXPERIENCE   -34.705049  3777.585499  -0.009187 0.992670  -7438.772627  7369.362529
                 SALARY_FROM     0.491695     0.001107 444.128154 0.000000      0.489525     0.493865
                   SALARY_TO     0.502428     0.000828 606.735237 0.000000      0.500805     0.504051
     MIN_YEARS_EXPERIENCE_SQ     7.107368     2.776885   2.559475 0.010531      1.664674    12.550063
    REMOTE_TYPE_NAME_encoded    -9.259747 19886.060024  -0.000466 0.999629 -38985.937394 38967.417901
EMPLOYMENT_TYPE_NAME_encoded    -9.793532 19886.065711  -0.000492 0.999607 -38986.482325 38966.895261

--- Intercept Statistics ---
Intercept: 698.76
Std Error: 48554.12348821889
T-Value: 0.014391268230764248
P-Value: 0.9885187677872751
95% CI: [-94467.3266220804, 95864.83745173764]

================================================================================
COMPARISON: LINEAR vs POLYNOMIAL REGRESSION
================================================================================

Linear Regression Test R²: 0.9994
Polynomial Regression Test R²: 0.9994
Improvement in R²: -0.0000

Linear Regression Test RMSE: $842.20
Polynomial Regression Test RMSE: $842.92
Change in RMSE: $0.72

Linear Regression Test MAE: $321.35
Polynomial Regression Test MAE: $318.55
Change in MAE: $-2.79

================================================================================
INTERPRETATION OF POLYNOMIAL REGRESSION RESULTS
================================================================================

1. MODEL PERFORMANCE INTERPRETATION:
   - R² Score (0.9994): The polynomial model explains 99.94% of
     the variance in SALARY, compared to 99.94% for the linear model.
     * The polynomial model does not improve over the linear model.
     * This suggests the relationship may be primarily linear.

   - RMSE ($842.92): Average prediction error for polynomial model.
     * The polynomial model has higher RMSE by $0.72.
     * This may indicate overfitting or that polynomial terms don't help.

   - MAE ($318.55): Average absolute error for polynomial model.
     * IMPROVEMENT: $2.79 reduction in MAE.

   - GOOD GENERALIZATION: Training R² (0.9990) and test R²
     (0.9994) are similar, indicating the model generalizes well.

2. POLYNOMIAL FEATURE INTERPRETATION:
   - MIN_YEARS_EXPERIENCE_SQ: This squared term captures non-linear relationships
     between experience and salary.
     * Positive coefficient: Salary increases at an accelerating rate with experience
       (e.g., senior positions command exponentially higher salaries)
     * Negative coefficient: Salary increases at a decelerating rate with experience
       (e.g., diminishing returns to additional years of experience)
     * The combination of MIN_YEARS_EXPERIENCE and MIN_YEARS_EXPERIENCE_SQ allows
       the model to fit a parabolic (curved) relationship.

3. MODEL SELECTION RECOMMENDATION:
   - The polynomial model does not substantially improve performance.
   - RECOMMENDATION: Prefer the simpler linear model (Occam's Razor).

================================================================================</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 43:&gt;                                                         (0 + 1) / 1]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+------------------+-----------------------------------------+
|SALARY|prediction        |features_poly                            |
+------+------------------+-----------------------------------------+
|49547 |47575.06433737733 |(12,[2,3,5,9],[38002.0,56014.0,1.0,1.0]) |
|41600 |42048.638224250564|(12,[2,3,5,10],[41600.0,41600.0,1.0,1.0])|
|66500 |67477.35735432831 |(12,[2,3,8,9],[43000.0,90000.0,1.0,1.0]) |
|50960 |51440.66331148057 |(12,[2,3,5,9],[47840.0,54080.0,1.0,1.0]) |
|56160 |56621.263311106864|(12,[2,3,5,9],[52000.0,60320.0,1.0,1.0]) |
|62400 |62891.02808117952 |(12,[2,3,6,9],[52000.0,72800.0,1.0,1.0]) |
|62400 |62891.02808117952 |(12,[2,3,6,9],[52000.0,72800.0,1.0,1.0]) |
|75550 |76083.94642066023 |(12,[2,3,5,9],[54000.0,97100.0,1.0,1.0]) |
|75556 |76089.78236197784 |(12,[2,3,5,9],[54018.0,97094.0,1.0,1.0]) |
|75556 |76089.78236197784 |(12,[2,3,5,9],[54018.0,97094.0,1.0,1.0]) |
+------+------------------+-----------------------------------------+
only showing top 10 rows</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
</section>
<section id="random-forest-regressor" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Random Forest Regressor</h1>
<div id="35c46838" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Random Forest model</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    featuresCol<span class="op">=</span><span class="st">"features"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    labelCol<span class="op">=</span><span class="st">"SALARY"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    numTrees<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    maxDepth<span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    maxBins<span class="op">=</span><span class="dv">32</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> rf.fit(train_final)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>train_predictions_rf <span class="op">=</span> rf_model.transform(train_final)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>test_predictions_rf <span class="op">=</span> rf_model.transform(test_final)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on training set</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>train_r2_rf <span class="op">=</span> evaluator_r2.evaluate(train_predictions_rf)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>train_rmse_rf <span class="op">=</span> evaluator_rmse.evaluate(train_predictions_rf)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>train_mae_rf <span class="op">=</span> evaluator_mae.evaluate(train_predictions_rf)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on test set</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>test_r2_rf <span class="op">=</span> evaluator_r2.evaluate(test_predictions_rf)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>test_rmse_rf <span class="op">=</span> evaluator_rmse.evaluate(test_predictions_rf)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>test_mae_rf <span class="op">=</span> evaluator_mae.evaluate(test_predictions_rf)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract feature importances</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>feature_importances <span class="op">=</span> rf_model.featureImportances</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>feature_importance_list <span class="op">=</span> [(feature_names[i], <span class="bu">float</span>(feature_importances[i])) </span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(feature_names))]</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>feature_importance_df <span class="op">=</span> pd.DataFrame(feature_importance_list, </span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>                                     columns<span class="op">=</span>[<span class="st">'Feature'</span>, <span class="st">'Importance'</span>])</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>feature_importance_df <span class="op">=</span> feature_importance_df.sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RANDOM FOREST REGRESSOR MODEL SUMMARY"</span>)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Model Hyperparameters ---"</span>)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of Trees: </span><span class="sc">{</span>rf<span class="sc">.</span>getNumTrees()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max Depth: </span><span class="sc">{</span>rf<span class="sc">.</span>getMaxDepth()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max Bins: </span><span class="sc">{</span>rf<span class="sc">.</span>getMaxBins()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Seed: </span><span class="sc">{</span>rf<span class="sc">.</span>getSeed()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Model Performance Metrics ---"</span>)</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Training Set Performance:"</span>)</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R² Score: </span><span class="sc">{</span>train_r2_rf<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  RMSE: $</span><span class="sc">{</span>train_rmse_rf<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  MAE: $</span><span class="sc">{</span>train_mae_rf<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Test Set Performance:"</span>)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R² Score: </span><span class="sc">{</span>test_r2_rf<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  RMSE: $</span><span class="sc">{</span>test_rmse_rf<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  MAE: $</span><span class="sc">{</span>test_mae_rf<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Feature Importances ---"</span>)</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(feature_importance_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INTERPRETATION OF RANDOM FOREST RESULTS"</span>)</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. HYPERPARAMETER SELECTION:"</span>)</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Number of Trees: </span><span class="sc">{</span>rf<span class="sc">.</span>getNumTrees()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * More trees generally improve performance but increase training time"</span>)</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Random Forest averages predictions across all trees, reducing variance"</span>)</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - Max Depth: </span><span class="sc">{</span>rf<span class="sc">.</span>getMaxDepth()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Controls how deep each tree can grow"</span>)</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Deeper trees = more complex patterns but higher overfitting risk"</span>)</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Shallower trees = simpler patterns but may underfit"</span>)</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. MODEL PERFORMANCE:"</span>)</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> test_r2_rf <span class="op">&gt;</span> test_r2 <span class="kw">and</span> test_r2_rf <span class="op">&gt;</span> test_r2_poly:</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * BEST PERFORMER: Outperforms both linear and polynomial models"</span>)</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> test_r2_rf <span class="op">&gt;</span> test_r2:</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * Outperforms linear regression"</span>)</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"     * Does not improve over simpler models"</span>)</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>overfitting_gap <span class="op">=</span> train_r2_rf <span class="op">-</span> test_r2_rf</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> overfitting_gap <span class="op">&gt;</span> <span class="fl">0.15</span>:</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - OVERFITTING WARNING: Training R² (</span><span class="sc">{</span>train_r2_rf<span class="sc">:.4f}</span><span class="ss">) is </span><span class="sc">{</span>overfitting_gap<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     higher than test R² (</span><span class="sc">{</span>test_r2_rf<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> overfitting_gap <span class="op">&gt;</span> <span class="fl">0.05</span>:</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - MINOR OVERFITTING: Training R² (</span><span class="sc">{</span>train_r2_rf<span class="sc">:.4f}</span><span class="ss">) is slightly higher"</span>)</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     than test R² (</span><span class="sc">{</span>test_r2_rf<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   - EXCELLENT GENERALIZATION: Training and test R² are very similar"</span>)</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. FEATURE IMPORTANCE:"</span>)</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>top_5_features <span class="op">=</span> feature_importance_df.head(<span class="dv">5</span>)</span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Top 5 Most Important Features:"</span>)</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> top_5_features.iterrows():</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"     </span><span class="sc">{</span>idx<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>row[<span class="st">'Feature'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>row[<span class="st">'Importance'</span>]<span class="sc">:.4f}</span><span class="ss"> (</span><span class="sc">{</span>row[<span class="st">'Importance'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Show sample predictions</span></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>test_predictions_rf.select(<span class="st">"SALARY"</span>, <span class="st">"prediction"</span>, <span class="st">"features"</span>).show(<span class="dv">10</span>, truncate<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 44:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 45:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 46:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 48:&gt;                                                         (0 + 1) / 1]                                                                                25/10/08 04:34:50 WARN DAGScheduler: Broadcasting large task binary with size 1110.8 KiB
25/10/08 04:34:51 WARN DAGScheduler: Broadcasting large task binary with size 1997.2 KiB
[Stage 58:&gt;                                                         (0 + 1) / 1][Stage 59:&gt;                                                         (0 + 1) / 1]                                                                                25/10/08 04:34:53 WARN DAGScheduler: Broadcasting large task binary with size 3.5 MiB
[Stage 60:&gt;                                                         (0 + 1) / 1][Stage 61:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 62:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 63:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 64:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 65:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 66:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 67:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
RANDOM FOREST REGRESSOR MODEL SUMMARY
================================================================================

--- Model Hyperparameters ---
Number of Trees: 200
Max Depth: 7
Max Bins: 32
Seed: 42

--- Model Performance Metrics ---

Training Set Performance:
  R² Score: 0.9815
  RMSE: $5,013.63
  MAE: $2,196.06

Test Set Performance:
  R² Score: 0.9838
  RMSE: $4,341.46
  MAE: $2,179.85

--- Feature Importances ---
                     Feature  Importance
                   SALARY_TO    0.525433
                 SALARY_FROM    0.329880
        MIN_YEARS_EXPERIENCE    0.078706
        MAX_YEARS_EXPERIENCE    0.056311
EMPLOYMENT_TYPE_NAME_encoded    0.002654
    REMOTE_TYPE_NAME_encoded    0.001870

================================================================================
INTERPRETATION OF RANDOM FOREST RESULTS
================================================================================

1. HYPERPARAMETER SELECTION:
   - Number of Trees: 200
     * More trees generally improve performance but increase training time
     * Random Forest averages predictions across all trees, reducing variance

   - Max Depth: 7
     * Controls how deep each tree can grow
     * Deeper trees = more complex patterns but higher overfitting risk
     * Shallower trees = simpler patterns but may underfit

2. MODEL PERFORMANCE:
     * Does not improve over simpler models

   - EXCELLENT GENERALIZATION: Training and test R² are very similar

3. FEATURE IMPORTANCE:

   Top 5 Most Important Features:
     4. SALARY_TO: 0.5254 (52.54%)
     3. SALARY_FROM: 0.3299 (32.99%)
     1. MIN_YEARS_EXPERIENCE: 0.0787 (7.87%)
     2. MAX_YEARS_EXPERIENCE: 0.0563 (5.63%)
     6. EMPLOYMENT_TYPE_NAME_encoded: 0.0027 (0.27%)

================================================================================</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 68:&gt;                                                         (0 + 1) / 1]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+------+------------------+----------------------------------------+
|SALARY|prediction        |features                                |
+------+------------------+----------------------------------------+
|49547 |53113.7350219114  |(11,[2,3,4,8],[38002.0,56014.0,1.0,1.0])|
|41600 |45844.392885971225|(11,[2,3,4,9],[41600.0,41600.0,1.0,1.0])|
|66500 |73389.582254297   |(11,[2,3,7,8],[43000.0,90000.0,1.0,1.0])|
|50960 |54690.23838122521 |(11,[2,3,4,8],[47840.0,54080.0,1.0,1.0])|
|56160 |58173.033435229016|(11,[2,3,4,8],[52000.0,60320.0,1.0,1.0])|
|62400 |63869.41647025877 |(11,[2,3,5,8],[52000.0,72800.0,1.0,1.0])|
|62400 |63869.41647025877 |(11,[2,3,5,8],[52000.0,72800.0,1.0,1.0])|
|75550 |77613.14843168529 |(11,[2,3,4,8],[54000.0,97100.0,1.0,1.0])|
|75556 |77613.14843168529 |(11,[2,3,4,8],[54018.0,97094.0,1.0,1.0])|
|75556 |77613.14843168529 |(11,[2,3,4,8],[54018.0,97094.0,1.0,1.0])|
+------+------------------+----------------------------------------+
only showing top 10 rows</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
<section id="feature-importance-plot" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="feature-importance-plot"><span class="header-section-number">6.1</span> Feature Importance Plot</h2>
<div id="49b5c4f7" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create feature importance plot</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>top_10_importance <span class="op">=</span> feature_importance_df.head(<span class="dv">10</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>top_10_importance, y<span class="op">=</span><span class="st">'Feature'</span>, x<span class="op">=</span><span class="st">'Importance'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance Score'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 10 Most Important Features - Random Forest Model'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'output/rf_feature_importance.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Feature Importance Interpretation ---"</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Random Forest feature importances measure the total reduction in prediction"</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"error contributed by each feature across all trees in the ensemble."</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>total_importance_top10 <span class="op">=</span> top_10_importance[<span class="st">'Importance'</span>].<span class="bu">sum</span>()</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">- Top 10 features account for </span><span class="sc">{</span>total_importance_top10<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">% of total importance"</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>total_importance_top5 <span class="op">=</span> feature_importance_df.head(<span class="dv">5</span>)[<span class="st">'Importance'</span>].<span class="bu">sum</span>()</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Top 5 features account for </span><span class="sc">{</span>total_importance_top5<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">% of total importance"</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> feature_importance_df.iloc[<span class="dv">0</span>][<span class="st">'Importance'</span>] <span class="op">&gt;</span> <span class="fl">0.4</span>:</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">WARNING: </span><span class="sc">{</span>feature_importance_df<span class="sc">.</span>iloc[<span class="dv">0</span>][<span class="st">'Feature'</span>]<span class="sc">}</span><span class="ss"> dominates with"</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>feature_importance_df<span class="sc">.</span>iloc[<span class="dv">0</span>][<span class="st">'Importance'</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">% importance!"</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"This strongly suggests data leakage."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_5298/1317290027.py:5: FutureWarning:



Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment04-lawrjosh_files/figure-html/cell-8-output-2.png" width="950" height="758" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Feature Importance Interpretation ---
Random Forest feature importances measure the total reduction in prediction
error contributed by each feature across all trees in the ensemble.

- Top 10 features account for 99.5% of total importance
- Top 5 features account for 99.3% of total importance

WARNING: SALARY_TO dominates with
52.5% importance!
This strongly suggests data leakage.</code></pre>
</div>
</div>
</section>
</section>
<section id="compare-3-models-glr-polynomial-rf" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Compare 3 Models – GLR, Polynomial, RF</h1>
<div id="698a9d9d" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate log-likelihood and BIC</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_log_likelihood_and_bic(predictions, n_params):</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    predictions_pd <span class="op">=</span> predictions.select(<span class="st">"SALARY"</span>, <span class="st">"prediction"</span>).toPandas()</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    residuals <span class="op">=</span> predictions_pd[<span class="st">"SALARY"</span>] <span class="op">-</span> predictions_pd[<span class="st">"prediction"</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    rss <span class="op">=</span> (residuals <span class="op">**</span> <span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    dispersion <span class="op">=</span> rss <span class="op">/</span> (<span class="bu">len</span>(predictions_pd) <span class="op">-</span> n_params)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(predictions_pd)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    log_likelihood <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> (n <span class="op">*</span> math.log(<span class="dv">2</span> <span class="op">*</span> math.pi) <span class="op">+</span> n <span class="op">*</span> math.log(dispersion) <span class="op">+</span> rss <span class="op">/</span> dispersion)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    bic <span class="op">=</span> n_params <span class="op">*</span> math.log(n) <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> log_likelihood</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> log_likelihood, bic</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate number of parameters for each model</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>n_features_linear <span class="op">=</span> <span class="bu">len</span>(feature_names)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>n_params_linear <span class="op">=</span> n_features_linear <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>n_features_poly <span class="op">=</span> <span class="bu">len</span>(poly_feature_names)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>n_params_poly <span class="op">=</span> n_features_poly <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>n_params_rf <span class="op">=</span> n_features_linear <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate log-likelihood and BIC for each model</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>log_likelihood_linear, bic_linear <span class="op">=</span> calculate_log_likelihood_and_bic(test_predictions, n_params_linear)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>log_likelihood_poly, bic_poly <span class="op">=</span> calculate_log_likelihood_and_bic(test_predictions_poly, n_params_poly)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>log_likelihood_rf, bic_rf <span class="op">=</span> calculate_log_likelihood_and_bic(test_predictions_rf, n_params_rf)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AIC</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    aic_linear <span class="op">=</span> summary.aic</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    aic_linear <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n_params_linear <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> log_likelihood_linear</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    aic_poly <span class="op">=</span> summary_poly.aic</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    aic_poly <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n_params_poly <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> log_likelihood_poly</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>aic_rf <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n_params_rf <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> log_likelihood_rf</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive comparison dataframe</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>comparison_metrics <span class="op">=</span> {</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Model'</span>: [<span class="st">'Linear Regression'</span>, <span class="st">'Polynomial Regression'</span>, <span class="st">'Random Forest'</span>],</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Test_R2'</span>: [test_r2, test_r2_poly, test_r2_rf],</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Test_RMSE'</span>: [test_rmse, test_rmse_poly, test_rmse_rf],</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Test_MAE'</span>: [test_mae, test_mae_poly, test_mae_rf],</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Train_R2'</span>: [train_r2, train_r2_poly, train_r2_rf],</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Overfitting_Gap'</span>: [train_r2 <span class="op">-</span> test_r2, train_r2_poly <span class="op">-</span> test_r2_poly, train_r2_rf <span class="op">-</span> test_r2_rf],</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AIC'</span>: [aic_linear, aic_poly, aic_rf],</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'BIC'</span>: [bic_linear, bic_poly, bic_rf],</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Log_Likelihood'</span>: [log_likelihood_linear, log_likelihood_poly, log_likelihood_rf],</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Num_Parameters'</span>: [n_params_linear, n_params_poly, n_params_rf]</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="op">=</span> pd.DataFrame(comparison_metrics)</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"COMPREHENSIVE MODEL COMPARISON"</span>)</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> comparison_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify best performers</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>best_r2_idx <span class="op">=</span> comparison_df[<span class="st">'Test_R2'</span>].idxmax()</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>best_rmse_idx <span class="op">=</span> comparison_df[<span class="st">'Test_RMSE'</span>].idxmin()</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>best_mae_idx <span class="op">=</span> comparison_df[<span class="st">'Test_MAE'</span>].idxmin()</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>best_aic_idx <span class="op">=</span> comparison_df[<span class="st">'AIC'</span>].idxmin()</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>best_bic_idx <span class="op">=</span> comparison_df[<span class="st">'BIC'</span>].idxmin()</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"BEST PERFORMERS BY METRIC"</span>)</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Best R² Score: </span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_r2_idx][<span class="st">'Model'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_r2_idx][<span class="st">'Test_R2'</span>]<span class="sc">:.4f}</span><span class="ss">)"</span>)</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best RMSE: </span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_rmse_idx][<span class="st">'Model'</span>]<span class="sc">}</span><span class="ss"> ($</span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_rmse_idx][<span class="st">'Test_RMSE'</span>]<span class="sc">:,.2f}</span><span class="ss">)"</span>)</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best MAE: </span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_mae_idx][<span class="st">'Model'</span>]<span class="sc">}</span><span class="ss"> ($</span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_mae_idx][<span class="st">'Test_MAE'</span>]<span class="sc">:,.2f}</span><span class="ss">)"</span>)</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best AIC: </span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_aic_idx][<span class="st">'Model'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_aic_idx][<span class="st">'AIC'</span>]<span class="sc">:,.2f}</span><span class="ss">)"</span>)</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best BIC: </span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_bic_idx][<span class="st">'Model'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>comparison_df<span class="sc">.</span>iloc[best_bic_idx][<span class="st">'BIC'</span>]<span class="sc">:,.2f}</span><span class="ss">)"</span>)</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predictions comparison dataframe</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>test_predictions_pd <span class="op">=</span> test_predictions.select(<span class="st">"SALARY"</span>, <span class="st">"prediction"</span>).toPandas()</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>test_predictions_pd.columns <span class="op">=</span> [<span class="st">"Actual"</span>, <span class="st">"Linear_Predicted"</span>]</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>test_predictions_poly_pd <span class="op">=</span> test_predictions_poly.select(<span class="st">"SALARY"</span>, <span class="st">"prediction"</span>).toPandas()</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>test_predictions_poly_pd.columns <span class="op">=</span> [<span class="st">"Actual_Poly"</span>, <span class="st">"Polynomial_Predicted"</span>]</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>test_predictions_rf_pd <span class="op">=</span> test_predictions_rf.select(<span class="st">"SALARY"</span>, <span class="st">"prediction"</span>).toPandas()</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>test_predictions_rf_pd.columns <span class="op">=</span> [<span class="st">"Actual_RF"</span>, <span class="st">"RF_Predicted"</span>]</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>predictions_df <span class="op">=</span> pd.concat([</span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>    test_predictions_pd,</span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>    test_predictions_poly_pd[<span class="st">"Polynomial_Predicted"</span>],</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>    test_predictions_rf_pd[<span class="st">"RF_Predicted"</span>]</span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">12</span>))</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Actual vs Predicted Salary - Model Comparison'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear Regression plot</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>predictions_df, x<span class="op">=</span><span class="st">"Actual"</span>, y<span class="op">=</span><span class="st">"Linear_Predicted"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].plot([predictions_df[<span class="st">"Actual"</span>].<span class="bu">min</span>(), predictions_df[<span class="st">"Actual"</span>].<span class="bu">max</span>()],</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>                [predictions_df[<span class="st">"Actual"</span>].<span class="bu">min</span>(), predictions_df[<span class="st">"Actual"</span>].<span class="bu">max</span>()],</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>                <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Perfect Prediction'</span>)</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="ss">f'Linear Regression</span><span class="ch">\n</span><span class="ss">R²=</span><span class="sc">{</span>test_r2<span class="sc">:.4f}</span><span class="ss">, RMSE=$</span><span class="sc">{</span>test_rmse<span class="sc">:,.0f}</span><span class="ss">'</span>)</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Actual Salary ($)'</span>)</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Predicted Salary ($)'</span>)</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].legend()</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Polynomial Regression plot</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>predictions_df, x<span class="op">=</span><span class="st">"Actual"</span>, y<span class="op">=</span><span class="st">"Polynomial_Predicted"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].plot([predictions_df[<span class="st">"Actual"</span>].<span class="bu">min</span>(), predictions_df[<span class="st">"Actual"</span>].<span class="bu">max</span>()],</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>                [predictions_df[<span class="st">"Actual"</span>].<span class="bu">min</span>(), predictions_df[<span class="st">"Actual"</span>].<span class="bu">max</span>()],</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>                <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Perfect Prediction'</span>)</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="ss">f'Polynomial Regression</span><span class="ch">\n</span><span class="ss">R²=</span><span class="sc">{</span>test_r2_poly<span class="sc">:.4f}</span><span class="ss">, RMSE=$</span><span class="sc">{</span>test_rmse_poly<span class="sc">:,.0f}</span><span class="ss">'</span>)</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Actual Salary ($)'</span>)</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Predicted Salary ($)'</span>)</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].legend()</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest plot</span></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>predictions_df, x<span class="op">=</span><span class="st">"Actual"</span>, y<span class="op">=</span><span class="st">"RF_Predicted"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].plot([predictions_df[<span class="st">"Actual"</span>].<span class="bu">min</span>(), predictions_df[<span class="st">"Actual"</span>].<span class="bu">max</span>()],</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>                [predictions_df[<span class="st">"Actual"</span>].<span class="bu">min</span>(), predictions_df[<span class="st">"Actual"</span>].<span class="bu">max</span>()],</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>                <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Perfect Prediction'</span>)</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="ss">f'Random Forest</span><span class="ch">\n</span><span class="ss">R²=</span><span class="sc">{</span>test_r2_rf<span class="sc">:.4f}</span><span class="ss">, RMSE=$</span><span class="sc">{</span>test_rmse_rf<span class="sc">:,.0f}</span><span class="ss">'</span>)</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Actual Salary ($)'</span>)</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Predicted Salary ($)'</span>)</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].legend()</span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals distribution</span></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>residuals_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Linear'</span>: predictions_df[<span class="st">"Actual"</span>] <span class="op">-</span> predictions_df[<span class="st">"Linear_Predicted"</span>],</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Polynomial'</span>: predictions_df[<span class="st">"Actual"</span>] <span class="op">-</span> predictions_df[<span class="st">"Polynomial_Predicted"</span>],</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Random Forest'</span>: predictions_df[<span class="st">"Actual"</span>] <span class="op">-</span> predictions_df[<span class="st">"RF_Predicted"</span>]</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>residuals_melted <span class="op">=</span> residuals_data.melt(var_name<span class="op">=</span><span class="st">'Model'</span>, value_name<span class="op">=</span><span class="st">'Residual'</span>)</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>residuals_melted, x<span class="op">=</span><span class="st">'Model'</span>, y<span class="op">=</span><span class="st">'Residual'</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Residuals Distribution by Model'</span>)</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Model'</span>)</span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Residual (Actual - Predicted)'</span>)</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INTERPRETATION OF MODEL COMPARISON"</span>)</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. INFORMATION CRITERIA INTERPRETATION:"</span>)</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - AIC (Akaike Information Criterion):"</span>)</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Measures model quality balancing fit and complexity"</span>)</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * LOWER is better - penalizes adding unnecessary parameters"</span>)</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Best for prediction-focused model selection"</span>)</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">   - BIC (Bayesian Information Criterion):"</span>)</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Similar to AIC but penalizes complexity more strongly"</span>)</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * LOWER is better - stronger penalty for model complexity"</span>)</span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     * Best for identifying the 'true' model structure"</span>)</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. FINAL RECOMMENDATION:"</span>)</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>votes <span class="op">=</span> {<span class="st">'Linear Regression'</span>: <span class="dv">0</span>, <span class="st">'Polynomial Regression'</span>: <span class="dv">0</span>, <span class="st">'Random Forest'</span>: <span class="dv">0</span>}</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>votes[comparison_df.iloc[best_r2_idx][<span class="st">'Model'</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>votes[comparison_df.iloc[best_rmse_idx][<span class="st">'Model'</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>votes[comparison_df.iloc[best_aic_idx][<span class="st">'Model'</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>votes[comparison_df.iloc[best_bic_idx][<span class="st">'Model'</span>]] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>winner <span class="op">=</span> <span class="bu">max</span>(votes, key<span class="op">=</span>votes.get)</span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Based on R², RMSE, AIC, and BIC: </span><span class="sc">{</span>winner<span class="sc">}</span><span class="ss"> wins </span><span class="sc">{</span>votes[winner]<span class="sc">}</span><span class="ss">/4 metrics"</span>)</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> winner <span class="op">==</span> <span class="st">'Linear Regression'</span>:</span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">   RECOMMENDATION: Use Linear Regression"</span>)</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - Simplest model with competitive performance"</span>)</span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - Most interpretable coefficients"</span>)</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> winner <span class="op">==</span> <span class="st">'Polynomial Regression'</span>:</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">   RECOMMENDATION: Use Polynomial Regression"</span>)</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - Captures non-linear relationships"</span>)</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - Still interpretable"</span>)</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">   RECOMMENDATION: Use Random Forest"</span>)</span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - Best predictive performance"</span>)</span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"   - Handles complex non-linear patterns"</span>)</span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">   IMPORTANT: All models suffer from data leakage (SALARY_FROM/SALARY_TO)"</span>)</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Remove these features and retrain for realistic production deployment"</span>)</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 69:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 70:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 71:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
COMPREHENSIVE MODEL COMPARISON
================================================================================

                Model  Test_R2   Test_RMSE    Test_MAE  Train_R2  Overfitting_Gap          AIC          BIC  Log_Likelihood  Num_Parameters
    Linear Regression 0.999390  842.199336  321.346659  0.999007        -0.000383 11365.733162 11397.550610    -5675.866581               7
Polynomial Regression 0.999389  842.917956  318.554628  0.999009        -0.000380 11368.931295 11405.294093    -5676.465648               8
        Random Forest 0.983800 4341.455231 2179.852597  0.981460        -0.002339 13648.540987 13680.358434    -6817.270493               7

================================================================================
BEST PERFORMERS BY METRIC
================================================================================

Best R² Score: Linear Regression (0.9994)
Best RMSE: Linear Regression ($842.20)
Best MAE: Polynomial Regression ($318.55)
Best AIC: Linear Regression (11,365.73)
Best BIC: Linear Regression (11,397.55)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 72:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 73:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 74:&gt;                                                         (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment04-lawrjosh_files/figure-html/cell-9-output-4.png" width="1333" height="1134" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
INTERPRETATION OF MODEL COMPARISON
================================================================================

1. INFORMATION CRITERIA INTERPRETATION:
   - AIC (Akaike Information Criterion):
     * Measures model quality balancing fit and complexity
     * LOWER is better - penalizes adding unnecessary parameters
     * Best for prediction-focused model selection

   - BIC (Bayesian Information Criterion):
     * Similar to AIC but penalizes complexity more strongly
     * LOWER is better - stronger penalty for model complexity
     * Best for identifying the 'true' model structure

2. FINAL RECOMMENDATION:
   Based on R², RMSE, AIC, and BIC: Linear Regression wins 4/4 metrics

   RECOMMENDATION: Use Linear Regression
   - Simplest model with competitive performance
   - Most interpretable coefficients

   IMPORTANT: All models suffer from data leakage (SALARY_FROM/SALARY_TO)
   Remove these features and retrain for realistic production deployment

================================================================================</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>